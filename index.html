<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Core 2.5D Engine</title>
    
    <!-- Fonte G√≥tica -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #0a050f;
            background-image: radial-gradient(circle at 20% 30%, #1a1020 0%, #0a050f 90%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Cinzel', 'Courier New', monospace;
        }
        
        canvas {
            border: 2px solid #5a4a6a;
            box-shadow: 0 0 30px rgba(170, 130, 200, 0.3);
            border-radius: 8px;
            image-rendering: crisp-edges;
        }
        
        .error-message {
            position: absolute;
            bottom: 20px;
            color: #c88;
            background: #1a0a1a;
            padding: 10px;
            border-left: 4px solid #a55;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <!-- IMPORTANTE: M√≥dulo principal com tratamento de erro -->
    <script type="module">
        import { Engine } from './js/engine.js';

        async function iniciarJogo() {
            try {
                const canvas = document.getElementById('gameCanvas');
                if (!canvas) throw new Error('Canvas n√£o encontrado');
                
                const ctx = canvas.getContext('2d');
                if (!ctx) throw new Error('Contexto 2D n√£o dispon√≠vel');
                
                console.log('üéÆ Iniciando Shadow Core Engine...');
                
                const engine = new Engine(ctx);
                await engine.start();
                
                console.log('‚úÖ Engine inicializada com sucesso');
                
                // Exp√µe para debug (opcional)
                window.engine = engine;
                
            } catch (error) {
                console.error('‚ùå Erro fatal:', error);
                
                // Mostra erro no canvas
                const canvas = document.getElementById('gameCanvas');
                const ctx = canvas?.getContext('2d');
                if (ctx) {
                    ctx.fillStyle = '#1a0a1a';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#c88';
                    ctx.font = '14px "Courier New", monospace';
                    ctx.fillText('ERRO: ' + error.message, 50, 100);
                    ctx.fillText('Verifique o console (F12)', 50, 140);
                }
            }
        }

        // Executar quando o DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', iniciarJogo);
        } else {
            iniciarJogo();
        }
    </script>
    <!-- CONTROLES MOBILE ‚Äî SIMPLES E FUNCIONAL -->
<div id="mobile-controls">
    <div class="control-grid">
        <button class="control-btn" data-key="w">‚ñ≤</button>
        <div></div>
        <button class="control-btn" data-key="a">‚óÄ</button>
        <button class="control-btn" data-key="s">‚ñº</button>
        <button class="control-btn" data-key="d">‚ñ∂</button>
    </div>
</div>

<style>
    #mobile-controls {
        position: fixed;
        bottom: 20px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        pointer-events: none;
        z-index: 1000;
    }
    
    .control-grid {
        display: grid;
        grid-template-columns: 70px 70px 70px;
        grid-template-rows: 70px 70px;
        gap: 10px;
        background: rgba(0, 0, 0, 0.6);
        padding: 15px;
        border-radius: 20px;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        pointer-events: auto;
    }
    
    .control-btn {
        width: 70px;
        height: 70px;
        background: rgba(30, 20, 40, 0.9);
        border: 2px solid #b07ac0;
        border-radius: 15px;
        color: white;
        font-size: 32px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 15px rgba(176, 122, 192, 0.3);
        transition: all 0.05s ease;
        cursor: pointer;
        user-select: none;
        touch-action: manipulation;
    }
    
    .control-btn:active {
        background: #b07ac0;
        transform: scale(0.9);
        box-shadow: 0 0 25px #ca8aca;
    }
    
    /* Esconder controles no desktop */
    @media (min-width: 1024px) {
        #mobile-controls {
            display: none;
        }
    }
</style>

<script>
    // Sistema de controles mobile
    (function() {
        // Simular teclas WASD
        const keyMap = {
            'w': 'w',
            'a': 'a',
            's': 's',
            'd': 'd'
        };
        
        function dispatchKey(key, type) {
            const event = new KeyboardEvent(type, {
                key: key,
                code: `Key${key.toUpperCase()}`,
                keyCode: key.charCodeAt(0) - 32,
                which: key.charCodeAt(0) - 32,
                bubbles: true
            });
            document.dispatchEvent(event);
        }
        
        // Adicionar eventos aos bot√µes
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.control-btn');
            
            buttons.forEach(btn => {
                const key = btn.dataset.key;
                
                // Touch events para mobile
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    dispatchKey(key, 'keydown');
                    btn.style.background = '#b07ac0';
                });
                
                btn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    dispatchKey(key, 'keyup');
                    btn.style.background = 'rgba(30, 20, 40, 0.9)';
                });
                
                btn.addEventListener('touchcancel', (e) => {
                    e.preventDefault();
                    dispatchKey(key, 'keyup');
                    btn.style.background = 'rgba(30, 20, 40, 0.9)';
                });
                
                // Mouse events para teste no desktop
                btn.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    dispatchKey(key, 'keydown');
                    btn.style.background = '#b07ac0';
                });
                
                btn.addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    dispatchKey(key, 'keyup');
                    btn.style.background = 'rgba(30, 20, 40, 0.9)';
                });
                
                btn.addEventListener('mouseleave', (e) => {
                    dispatchKey(key, 'keyup');
                    btn.style.background = 'rgba(30, 20, 40, 0.9)';
                });
            });
        });
    })();
</script>
</body>
</html>